<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Movie Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="container my-5">
    <h2 class="mb-4">Add Movie</h2>
    <form id="movieForm">
        <div class="mb-3">
            <label for="movieName" class="form-label">Movie Name</label>
            <input type="text" class="form-control" id="movieName" required />
            <div class="invalid-feedback">Movie Name must be at least 5 characters.</div>
        </div>

        <div class="mb-3">
            <label for="actor" class="form-label">Actor</label>
            <input type="text" class="form-control" id="actor" required />
            <div class="invalid-feedback">Actor name must be at least 3 characters.</div>
        </div>

        <div class="mb-3">
            <label for="release" class="form-label">Release Date</label>
            <input type="date" class="form-control" id="release" required />
        </div>

        <div class="mb-3">
            <label class="form-label">Movie Type</label><br />
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" value="2D" id="type2D" />
                <label class="form-check-label" for="type2D">2D</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" value="3D" id="type3D" />
                <label class="form-check-label" for="type3D">3D</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" value="IMAX" id="typeIMAX" />
                <label class="form-check-label" for="typeIMAX">IMAX</label>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Add Movie</button>
    </form>

    <h3 class="mt-5">Movie List</h3>
    <table class="table table-bordered mt-3" id="movieTable">
        <thead>
            <tr>
                <th>Movie Name</th>
                <th>Actor</th>
                <th>Release</th>
                <th>Type</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        document.getElementById("movieForm").addEventListener("submit", function (e) {
            e.preventDefault();

            const movieName = document.getElementById("movieName").value.trim();
            const actor = document.getElementById("actor").value.trim();
            const release = document.getElementById("release").value;
            const types = [];

            if (document.getElementById("type2D").checked) types.push("2D");
            if (document.getElementById("type3D").checked) types.push("3D");
            if (document.getElementById("typeIMAX").checked) types.push("IMAX");

            // Validation
            let isValid = true;
            if (movieName.length < 5) {
                isValid = false;
                document.getElementById("movieName").classList.add("is-invalid");
            } else {
                document.getElementById("movieName").classList.remove("is-invalid");
            }

            if (actor.length < 3) {
                isValid = false;
                document.getElementById("actor").classList.add("is-invalid");
            } else {
                document.getElementById("actor").classList.remove("is-invalid");
            }

            if (!isValid) return;

            const movieData = { movieName, actor, release, types };

            // Send to server using AJAX
            // for cors: "http://localhost:3000/api/movies"
            fetch("/api/movies", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(movieData),
            })
                .then((res) => res.json())
                .then((data) => {
                    appendToTable(data);
                    document.getElementById("movieForm").reset();
                })
                .catch((err) => {
                    console.error("Error:", err.message || err);
                })
        });

        function appendToTable(movie) {
            const tbody = document.getElementById("movieTable").querySelector("tbody");
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${movie.movieName}</td>
                <td>${movie.actor}</td>
                <td>${movie.release}</td>
                <td>${movie.types.join(", ")}</td>
            `;
            tbody.appendChild(row);
        }
    </script>
</body>

</html>